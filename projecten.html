<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Projecten</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <nav>
        <ul>
            <li><a href="index.html">Hoofdpagina</a></li>
            <li><a href="bibliotheek.html">Bibliotheek</a></li>
            <li><a href="opties.html">Opties</a></li>
            <li><a href="projecten.html" class="active">Projecten</a></li>
        </ul>
    </nav>
    <main>
        <h1>Projecten</h1>
        <p>Hier kunt u projecten toevoegen en de positie-zoneverdeling instellen.</p>
        <div>
            <label for="projectNumber">Projectnummer:</label>
            <input type="text" id="projectNumber" placeholder="Bijv. 001">
        </div>
        <div>
            <label for="jsonFile">Upload JSON-bestand:</label>
            <input type="file" id="jsonFile" accept=".json">
        </div>
        <div>
            <h3>Positie-Zoneverdeling</h3>
            <p>Voer zones in voor elke positie (komma-gescheiden, bijv. 1,2,-3):</p>
            <div id="zoneSelection">
                <div>
                    <label for="framenZones">Framen:</label>
                    <input type="text" id="framenZones" placeholder="Bijv. 1,2,-3">
                </div>
                <div>
                    <label for="binnenfolieZones">Binnenfolie / Beplating:</label>
                    <input type="text" id="binnenfolieZones" placeholder="Bijv. 4,5,-6">
                </div>
                <div>
                    <label for="sluitingZones">Sluiting:</label>
                    <input type="text" id="sluitingZones" placeholder="Bijv. 7,8,-9">
                </div>
            </div>
        </div>
        <button onclick="voegProjectToe()">Project toevoegen</button>
        <h2>Projectenlijst</h2>
        <table id="projectenLijst">
            <thead>
                <tr>
                    <th>Projectnummer</th>
                    <th>Framen Zones</th>
                    <th>Binnenfolie / Beplating Zones</th>
                    <th>Sluiting Zones</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </main>

    <script>
        let jsonData = [];

        document.getElementById('jsonFile').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        jsonData = JSON.parse(e.target.result);
                        console.log('JSON-data geladen:', jsonData);
                    } catch (error) {
                        alert('Fout bij het laden van het JSON-bestand: ' + error.message);
                    }
                };
                reader.readAsText(file);
            }
        });

        function voegProjectToe() {
            const projectNumber = document.getElementById('projectNumber').value;
            if (!projectNumber) {
                alert('Voer een projectnummer in.');
                return;
            }

            const framenZonesInput = document.getElementById('framenZones').value;
            const binnenfolieZonesInput = document.getElementById('binnenfolieZones').value;
            const sluitingZonesInput = document.getElementById('sluitingZones').value;

            // Converteer comma-gescheiden input naar arrays van getallen (inclusief negatieve getallen)
            const framenZones = framenZonesInput ? framenZonesInput.split(',').map(num => parseInt(num.trim())).filter(num => !isNaN(num)) : [];
            const binnenfolieZones = binnenfolieZonesInput ? binnenfolieZonesInput.split(',').map(num => parseInt(num.trim())).filter(num => !isNaN(num)) : [];
            const sluitingZones = sluitingZonesInput ? sluitingZonesInput.split(',').map(num => parseInt(num.trim())).filter(num => !isNaN(num)) : [];

            const positionZoneMapping = {
                framen: framenZones,
                binnenfolie: binnenfolieZones,
                sluiting: sluitingZones
            };

            const projects = JSON.parse(localStorage.getItem('projects')) || [];
            projects.push({
                number: projectNumber,
                positionZoneMapping: positionZoneMapping,
                jsonFiles: [{ data: jsonData }]
            });
            localStorage.setItem('projects', JSON.stringify(projects));

            const tableBody = document.getElementById('projectenLijst').getElementsByTagName('tbody')[0];
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${projectNumber}</td>
                <td>${framenZones.join(', ') || 'Geen'}</td>
                <td>${binnenfolieZones.join(', ') || 'Geen'}</td>
                <td>${sluitingZones.join(', ') || 'Geen'}</td>
            `;
            tableBody.appendChild(row);

            // Reset het formulier
            document.getElementById('projectNumber').value = '';
            document.getElementById('jsonFile').value = '';
            document.getElementById('framenZones').value = '';
            document.getElementById('binnenfolieZones').value = '';
            document.getElementById('sluitingZones').value = '';
            jsonData = [];
        }

        window.onload = function() {
            const projects = JSON.parse(localStorage.getItem('projects')) || [];
            const tableBody = document.getElementById('projectenLijst').getElementsByTagName('tbody')[0];
            projects.forEach(project => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${project.number}</td>
                    <td>${project.positionZoneMapping.framen.join(', ') || 'Geen'}</td>
                    <td>${project.positionZoneMapping.binnenfolie.join(', ') || 'Geen'}</td>
                    <td>${project.positionZoneMapping.sluiting.join(', ') || 'Geen'}</td>
                `;
                tableBody.appendChild(row);
            });
        };
    </script>
</body>
</html>
